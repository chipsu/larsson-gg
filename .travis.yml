sudo: required
dist: trusty
language: node_js
node_js:
- 8.9.4
before_script:
- npm install
script:
- npm run build
after_success:
- if [[ " master stage " =~ .*\ $TRAVIS_BRANCH\ .* ]]; then REPO_ORG=$(echo $TRAVIS_REPO_SLUG
  | cut -d "/" -f 1); REPO_NAME=$(echo $TRAVIS_REPO_SLUG | cut -d "/" -f 2); COMPOSE_FILE=docker-compose.yml;
  RANCHER_STACK=$TRAVIS_REPO_SLUG; if [[ -f docker-compose-$TRAVIS_BRANCH.yml ]];
  then COMPOSE_FILE=docker-compose-$TRAVIS_BRANCH.yml; RANCHER_STACK=$RANCHER_STACK-$TRAVIS_BRANCH;
  fi; docker build -t $DOCKER_USERNAME/$REPO_NAME .; docker tag $DOCKER_USERNAME/$REPO_NAME
  $DOCKER_USERNAME/$REPO_NAME:$(git rev-parse --short HEAD); docker tag $DOCKER_USERNAME/$REPO_NAME
  $DOCKER_USERNAME/$REPO_NAME:$TRAVIS_BRANCH; docker login -u="$DOCKER_USERNAME" -p="$DOCKER_PASSWORD";
  docker push $DOCKER_USERNAME/$REPO_NAME; wget -qO- https://github.com/rancher/rancher-compose/releases/download/v0.12.5/rancher-compose-linux-amd64-v0.12.5.tar.xz
  | tar -xvJ --strip=2; ./rancher-compose -f $COMPOSE_FILE -p $RANCHER_STACK up --pull
  --upgrade -d; echo todo, tests or rancher-compose up -p $RANCHER_STACK -d --rollback;
  echo todo if ok, rancher-compose up -p $RANCHER_STACK -d --confirm-upgrade; fi
env:
  global:
  - secure: a/s0KX766xmIwLQqJ3ppNs/W9C5PiHGsT6BJto7h/k5xyD5YWV7Xf+Ma3oIAueJnXrEOueC+A5Qs9hY6wfjvqLYrN7zcpUr6NPgqc7BAJ6P3PINPeZ2reH+ZdKJIo0SWJLniur2c85k9NwnfD4uoUAU5ce/PybZ0rFwgd6wemfls0HZWpoddGcmxM+llAt9SoQWTifEgFQ9iTJxirxS52upUUVgtK+QohMNL6E2gg38dyBbU1M5PEWu+RATK4SxyqPWpDryDaXB53MTiGeuFINiHfPU+Oo1BKpAZgk3MIQsrkk6Bbo3eEjxFpUyoN5MbXCnOJ0J8cUqR0m1hnShgmJbsMtE9rih6UraWe/4u+BvdDg33OgMBSCDaYkDP6sJz/tLSxmMVcr4SMy3lVn9EKb8fA0PWYlSWiB8bS8aP3OtWQr+8rcRE9L1NchR7gnJB3tIwUWlZbSO4IiWgcWeJEVM3olmVBPk9hFO+C9h8uJFcRs5W/maHb+jWB5h9PORg8MnmIZVPpZjCkBlf2EsTl1cSlT2V0GJFW/v/1vu/8+p6vGNZ5rbvEnmwRt1SfmtMbGdx2bWcjkK3nwtFio9QwVhC1thdopwe5ZzHHQNpr7Zv+oMkzU+KWNitpVQQHrGIT2AjNMZ6y7vs8rElpI8H+j4eMOv7Q0UdvexdMYZD/Vs=
  - secure: IqkmaKTLdnClQ5I1T5aNcCRbXCFyO0P7j2wMoX3Mlo41v6t78X8PJqf9lEJCcm7PSfwYAQ9h/RRdBqjLI8PpkYIl5XVet4qEjfl3/fuefXZdeGi+8VgE1U7Pa1R9kmkN+06h6UKUQrP8MsFVMT6o2VYPSkEWlg/JgTw+18XTfnXDuavkI0Z/xX96U0d5oUawc57UYEtNgd+WIdXCId4sWibWzxK/laQExjWY9868Gnu0wZXwOQO252CFbJj5qKSYEor6df/3Jg0wJ6YDj4MJ+SCANlyNQrQUm3FncauNx9QlC7DXSSoh9pzRdEwXd3XaMb/a9d7HfcMz6PxnxJaadrVVift89iqS8EFAq8cyCpCj8cv3OpM5x5CGC0SU/0iP+HZk0Ulf+3fh/LXojSm2HcWrUvFqYCvVpU1fAWNVQ1M7paMy8QnAwADw4336rXckzztyM5vlWm/QSR5ACXBda0q7kxwHu8csifPBm9piJ+tvzF1ICO5FU+6QyVBoMUNMuJlYrCssRJb0kF76KXZUMZQqNGAnk1WoYyzLSWNqoJI5/I9fECkmluQWOjb9/qQMyfQPSiO/hfyEEI16Wpi65ZpXkNpxEQc3Hioc08EDtkePoGE8RGw+p52c3EZJt7/irbBzKGdldUTSid+kgw0rt/qp51DYy/Hk67JkE3Ze45w=
  - secure: rRZ86bM10/Ob63I1K0njwSuvZVFUjqvPhZdRJPhfjk0+hjfrfRQAsmc7w0UBy4RgRYhidu1peBLOSwoGj02BObAR0K5ZdT9Bh+eJ5sBYvQA2X4radD0RQWkQtYQCY5VNH7GS3YvrPIbIoMtByJwdxs96yov5k1paG78EEcPgkw87BI7TbkxfWIYFDvuNcADZPkuUQpMcXGLhGxGaRYuYrYACnEBDp4J3N0h1TiVmoWQh2BcRpRBzunvT0QbCRDyrsonbNVSgGYJcbt0bKaJg9K1Nlctc9/sH2G/1mRa4ZFzjmWUR6CUOGcOQgBQt2iE+ZtzMn/CrnnW6MBWIakw7cBxE6OJIWXFLHc+zb225zoW+iy8i+5NTsR8u5l6WTaYKnqoNV8GpcQdt0TBeAZBEVkj93zDrV/1R1HSIhGFEy3/To5R9EA5IbKV9ocNmjl7z/pOhwA4pn3RdPwH3qUu7LBMsBfgm3dh6zliHq5R6r7g7HYYSTAZZAyIXr/3znJg6P4FhH0HbM5bnXdY1l3hm044FdjlwYjYsWHIJH1LqMp6a0sLcb7MdEgYZBIwRZETG2gjEuxat0U4w/4au6i1p1wwIy94RNwS/NzK/na7xNPlb3TTEY17akdQjqxdUdUz8/c11G6hZlJIMrLYTYkIX6hVXZQhf7q7FtkKhX2ggMqQ=
  - secure: lVxNtA8rsqBp07DeRhA90egnigCU10RP3zcubFwq9eib+Ei0Y1yAm/NIYuFV280BzwSNtby6XpJVOMlJDpdk0Q4FSwk6+AUN/GzmXcBtQb8NIdMbptpstjSM86KFJvfksjyLhPtd/dnY5ruEohhSaRbBM1CSKytvsTju1GlYklHx5iDxp89PVQd76guoIGWuzDdhYHVE0mY0am4cC/rw+iwGDJ9KnJnPn+spVp22noo3Nj1Z0KRRfMeuYj1cVv+LJBRQD+WjTcfWYTbCA+Z0U7sFt7Wz0haLmL7FP3ixb760Tec5T/p2+1rNXdT2y727c84I8r9OQ4uCJ2yMto34tKoO85SvwarQQ+h2dossQNsxTLU1Zm9eN58BTBX7Nh0k6z11fdlyT7E45/vG+oLBAp++ZClrGOOjTabe5INbBebRKxdv7KwETDIGg/mSXKGcP+iLvToE41OTPub5O3cH21I5+dtQ4nSSaSQIze8tWZncek5oq1WaF897Vx4mfyW+4b+WIpbGrLJLnpnuVAEiBUSh3L4oMoFQq25YNGE59dmXybVGaEsK/JAmssrJX7+uuO47VSxFHtWkq08CxVTb5D0HgCBACT00P6UQGWOyXR/FshnrqWYkvf/GtMSGgOf8lVK1Ehul6jh+IgUzGbNnUtVShkkxE9i38oakfLRFuJU=
  - secure: gWLBkodd/nf4z3BR5ERaEAoLT1guJhfMgjHEhXcGQ3pcN74hKoA+wg4FspVf5E7lElDcl3LQiCOKARjBsY5YNvOHa9cQ8Sb6X4pXtI14mH3mPNodihwDVsi2yUIE4dbZNAdogK6D3wvkIVMXOPgooGtdWHHyIEgBZoJOsPzkYkmBs2Glzl09J7uTm7SW5SeqbiH/IRVma3R27xRO+s+mMKjozysYBy7Je6n1Jv3cXaZzIDf3LeG0OCmb+w2zUPszwslcv9ihhrNLjvpf2xLxi0gmnyebgXFsjgvbO0b++ysyNwQmoDu9ZIohoQsYu/KHl+AAbHAIO0niLl6DZeyNJHMngbj3QrU4RNmu1f5JCyUMscen198wHlRAp6EChpycSyD917L6sgC5Sp1WoN97Ug2rTU23ClwEtPPdkAiH2HbQn/DIfBGU959MQz4U88AtimK165Iq5W1b26skJN62YVh2rW1B0XCCAIzY6r+wMogUomH8K/7z1z7yxokfiHYgLKGpJanSMaAW2fB/AmmeKUAs8Yg6/2E2mefhw2Uq3HD28J2Yt2y7B4og/n0UHtqJiCdhTHI6OZWqaf8UgKJJZdJbpuY7FVAN/R4u3q/3JMG0Ht3N1vRPZ8TFlNfOiBDhSaYEK0CFk5OtWVvAaK3cpovKAE1aCPvGe/rbBulSBzE=
